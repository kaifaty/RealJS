"use strict";function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,a=new Array(e.length);t<e.length;t++)a[t]=e[t];return a}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,a){return t&&_defineProperties(e.prototype,t),a&&_defineProperties(e,a),e}var Real=function(){function a(e,t){_classCallCheck(this,a),this._initCss(),this.data=t,this.node=e,this.arraynodes2update={},this.nodes2update={},this.scanAppNode(this.node),this.updateAllNodes(),this.updateAllArrayNodes()}return _createClass(a,[{key:"_initCss",value:function(){var e=document.createElement("style");e.type="text/css",e.innerHTML=".d-none { display: none !important; }",document.getElementsByTagName("head")[0].appendChild(e)}},{key:"scanAppNode",value:function(e){function r(e,t){for(var a=0;a<t.length;a++){var r=t[a],n=e.cloneNode();i.nodes2update[r]?i.nodes2update[r].push({node:e,origin:n}):i.nodes2update[r]=[{node:e,origin:n}]}}var i=this;this.scanTree(e,function(e){if("#text"===e.nodeName)r(e,getEntries(e.data));else{if("#text"!==e.nodeName&&e.dataset.array){e.classList.add("d-none");var t=e.dataset.array;return i.arraynodes2update[t]?i.arraynodes2update[t].push({origin:e,nodes:[]}):i.arraynodes2update[t]=[{origin:e,nodes:[]}],!1}if(0<e.attributes.length)for(var a=0;a<e.attributes.length;a++)r(e,getEntries(e.attributes[a].name)),r(e,getEntries(e.attributes[a].value))}return!0})}},{key:"scanTree",value:function(e,t,a){var r=[e],n=[a];t(e,a);for(var i=0;i<r.length;i++){var o=r[i];r.splice(i,1);var s=void 0;a&&(s=n[i],n.splice(i,1));for(var d=0;d<o.childNodes.length;d++)if(o.childNodes.length){if(t&&!t(o.childNodes[d],!!a&&s.childNodes[d]))continue;r.push(o.childNodes[d]),a&&n.push(s.childNodes[d])}i--}}},{key:"fillNodeData",value:function(e,t,a,r,n){if(a&&3===a.nodeType){var i=a.data;if(i){var o=format(i,t,this.data,r);/(<br>|<b>|<i>)/.test(o)?this.nodes2update[n]?(3===e.nodeType&&n&&this.nodes2update[n]&&(this.nodes2update[n][r].node=e.parentNode),this.nodes2update[n][r].node.innerHTML=o):e.parentNode.innerHTML=o:e.textContent=o}}else if(a&&3!==a.nodeType){for(var s=0;s<e.attributes.length;s++){var d=e.attributes[s].name;a.attributes.getNamedItem(d)||(e.removeAttribute(d),["disabled","checked"].includes(d)&&(e[d]=!1))}for(var u=0;u<a.attributes.length;u++){var l=a.attributes[u].name,c=a.attributes[u].value,f=e.attributes.getNamedItem(l)||{},p=f.name,h=f.value,v=c;"class"===l&&(v=v.replace("d-none","")),v=format(v,t,this.data,r);var y=format(l,t,this.data,r);p!==y&&y?(e.setAttribute(y,v),["disabled","checked"].includes(y)&&(e[y]=!0)):p&&!y?e.removeAttribute(p):p&&y&&p!==y?e.setAttribute(y,v):h!==v&&(f.value=v)}if(e.dataset.function){var g=e.dataset.function,m=g.match(/\(([a-zA-Z0-9_. ,]+)\)/);if(m){m=m[1].split(",");for(var b=0;b<m.length;b++)m[b]=m[b].trim(),"context"===m[b]&&(m[b]=e);var A,N=g.replace(/\(([a-zA-Z0-9_. ,]+)\)/,"");if(D[N])(A=D)[N].apply(A,_toConsumableArray(m))}}}}},{key:"updateNode",value:function(e){var t=this.nodes2update[e];if(t)for(var a=0;a<t.length;a++)this.fillNodeData(t[a].node,this.data,t[a].origin,a,e);return t}},{key:"updateAllNodes",value:function(){for(var e in this.nodes2update)this.nodes2update.hasOwnProperty(e)&&this.updateNode(e)}},{key:"updateArrayNode",value:function(n){var e,t,a,r,i,o=this,s=this.arraynodes2update[n],d=getVar(this.data,n);if(d){"function"==typeof d&&(d=d.apply(this.data));var u=function(e,t,a,r){o.scanTree(t,function(e,t){return o.fillNodeData(e,a,t,r,n),!0},e)};if(s)for(var l=0;l<s.length;l++)for(var c=s[l].origin,f=s[l].nodes,p=0;p<Math.max(d.length,f.length);p++)f[p]?d[p]&&f[p]?(u(c,f[p],d[p],p),f[p].classList.remove("d-none"),delete f[p].dataset.array):!d[p]&&f[p]&&(f[p].remove(),f.splice(p,1),p--):(e=f,t=c,a=d[p],r=p,i=void 0,(i=t.cloneNode(!0)).classList.remove("d-none"),delete i.dataset.array,t.parentNode.insertBefore(i,t),u(t,i,a,r),e.push(i));else log("can't find node: "+n)}}},{key:"updateAllArrayNodes",value:function(){for(var e in this.arraynodes2update)this.arraynodes2update.hasOwnProperty(e)&&this.updateArrayNode(e)}}]),a}();function getVar(e,t){for(var a=e,r=t.trim().split("."),n=0;n<r.length;n++){var i=a[r[n]];if(void 0===i)return;a=i}return a}function keypath(a,e,t){if(e.indexOf("[")&&(e=e.replace(/\[([a-zA-Z0-9_,.= ]+)\]/g,function(e,t){return getVar(a,t)})),e.indexOf("(")){var r=!1,n=[],i=e.replace(/\(([a-zA-Z0-9_,.\[\]= ]+)\)/g,function(e,t){return r=!0,n=t.split(","),""});if(r)return"function"==typeof(i=~i.indexOf(".")?getVar(a,i):a[i])?i.apply(void 0,_toConsumableArray(n)):t}var o=getVar(a,e);return void 0===o?t:o}function format(e,r,n,t){return r&&e?(e=(e=e.replace("{i}",t)).replace("[i]","."+t)).replace(/\{([a-zA-Z0-9_.,=\[\])( ]+)\}/g,function(e,t){var a=keypath(r,t,e);return a!==e?a:keypath(n,t,e)}):e}function getEntries(e){var a=[];return e.replace(/\{([a-zA-Z0-9_.,=\[\])( ]+)\}/g,function(e,t){a.push(t)}),a}